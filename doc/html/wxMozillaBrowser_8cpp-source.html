<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>wxMozillaBrowser.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.11 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>wxMozillaBrowser.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002  * wxWindows Mozilla Browser Component
00003  * 
00004  * Copyright 2001 (c) Jeremiah Cornelius McCarthy. All Rights Reserved.
00005  */
00006 
00007 <font class="preprocessor">#include &lt;gtk/gtk.h&gt;</font>
00008 <font class="comment">// Pertinent embedding interfaces</font>
00009 <font class="preprocessor">#include "nsCOMPtr.h"</font>
00010 <font class="preprocessor">#include "nsEmbedAPI.h"</font>
00011 <font class="preprocessor">#include "nsIBaseWindow.h"</font>
00012 <font class="preprocessor">#include "nsIWebBrowser.h"</font>
00013 <font class="preprocessor">#include "nsIWebBrowserChrome.h"</font>
00014 <font class="preprocessor">#include "nsIWebNavigation.h"</font>
00015 <font class="preprocessor">#include "nsIWindowCreator.h"</font>
00016 <font class="preprocessor">#include &lt;nsIEventQueueService.h&gt;</font>
00017 <font class="preprocessor">#include "nsString.h"</font>
00018 <font class="preprocessor">#include "nsCWebBrowser.h"</font>
00019 
00020 <font class="preprocessor">#include "wxMozillaBrowser.h"</font>
00021 <font class="preprocessor">#include "wxMozillaBrowserChrome.h"</font>
00022 <font class="comment">//#include "wxMozillaBrowserEmbeddingWindow.h"</font>
00023 
00024 <font class="keyword">static</font> NS_DEFINE_CID(kEventQueueServiceCID, NS_EVENTQUEUESERVICE_CID);
00025 <font class="keyword">static</font> gint io_id = 0;
00026 
00027 IMPLEMENT_DYNAMIC_CLASS(<a class="code" href="classwxMozillaBrowser.html">wxMozillaBrowser</a>, wxWindow)
00028 
00029 BEGIN_EVENT_TABLE(<a class="code" href="classwxMozillaBrowser.html">wxMozillaBrowser</a>, wxWindow)
00030         EVT_SIZE(wxMozillaBrowser::OnSize)
00031 END_EVENT_TABLE()
00032 
00033 <font class="keyword">const</font> wxChar *wxMozillaBrowserNameStr = wxT(<font class="stringliteral">"Mozilla"</font>);
00034 
00035 <font class="keyword">static</font> <font class="keywordtype">void</font> handle_event_queue(gpointer data,  gint source, GdkInputCondition cond)<font class="keyword"></font>
00036 {
00037         nsIEventQueue *eventQueue = (nsIEventQueue *)data;
00038         eventQueue-&gt;ProcessPendingEvents();
00039 }
00040 
<a name="l00048"></a><a class="code" href="classwxMozillaBrowser.html#a0">00048</a> <a class="code" href="classwxMozillaBrowser.html#a0">wxMozillaBrowser::wxMozillaBrowser</a>()<font class="keyword"></font>
00049 {
00050 <font class="comment">//      NS_INIT_REFCNT();</font>
00051 <font class="comment">//      NS_InitEmbedding(nsnull, nsnull);</font>
00052 
00053 <font class="comment">//      EmbedWindow = new wxMozillaBrowserEmbeddingWindow();</font>
00054 }
00055 
<a name="l00062"></a><a class="code" href="classwxMozillaBrowser.html#a2">00062</a> <a class="code" href="classwxMozillaBrowser.html#a2">wxMozillaBrowser::~wxMozillaBrowser</a>()<font class="keyword"></font>
00063 {
00064         gdk_input_remove(io_id);
00065         NS_TermEmbedding();
00066 }
00067 
<a name="l00086"></a><a class="code" href="classwxMozillaBrowser.html#a3">00086</a> <font class="keywordtype">bool</font> <a class="code" href="classwxMozillaBrowser.html#a3">wxMozillaBrowser::Create</a>(wxWindow *parent, wxWindowID id, <font class="keyword">const</font> wxPoint &amp;pos, <font class="keyword">const</font> wxSize &amp;size, <font class="keywordtype">long</font> style, <font class="keyword">const</font> wxString &amp;name)<font class="keyword"></font>
00087 {
00088         nsresult rv;
00089         
00090         m_needParent = TRUE;
00091         m_acceptsFocus = TRUE;
00092 
00093         <font class="keywordflow">if</font>(!PreCreation(parent, pos, size) ||
00094                 !CreateBase(parent, id, pos, size, style, wxDefaultValidator, name))<font class="keyword"></font>
00095         {
00096                 wxFAIL_MSG(wxT(<font class="stringliteral">"wxMozillaBrowser failed!"</font>));
00097                 <font class="keywordflow">return</font> FALSE;
00098         }
00099 
00100         m_widget = gtk_event_box_new();
00101         
00102         m_parent-&gt;DoAddChild(<font class="keyword">this</font>);
00103         PostCreation();
00104 <font class="comment">//      wxWindow::Create(parent, id, pos, size, style, name);</font>
00105                 
00106 <font class="comment">//      gdk_threads_leave();</font>
00107         gtk_widget_realize(GTK_WIDGET(m_parent-&gt;m_widget));
00108         gtk_widget_realize(GTK_WIDGET(m_widget));
00109 <font class="comment">//      gdk_threads_enter();</font>
00110 
00111         <font class="comment">/*</font>
00112          * MOZILLA
00113          */
00114         NS_InitEmbedding(nsnull, nsnull);
00115 
00116         nsCOMPtr &lt;nsIEventQueueService&gt; eventQService = do_GetService(kEventQueueServiceCID);
00117         <font class="keywordflow">if</font>(!eventQService)
00118         {
00119                 printf(<font class="stringliteral">"Failed to create EventQueueService!\n"</font>);
00120                 <font class="keywordflow">return</font> NS_ERROR_FAILURE;
00121         }
00122         
00123         nsCOMPtr &lt;nsIEventQueue&gt; eventQueue;
00124         eventQService-&gt;GetThreadEventQueue(NS_CURRENT_THREAD, getter_AddRefs(eventQueue));
00125         <font class="keywordflow">if</font>(!eventQueue)
00126         {
00127                 printf(<font class="stringliteral">"Failed to create EventQueue!\n"</font>);
00128                 <font class="keywordflow">return</font> NS_ERROR_FAILURE;
00129         }
00130         io_id = gdk_input_add(eventQueue-&gt;GetEventQueueSelectFD(), GDK_INPUT_READ, handle_event_queue, eventQueue);
00131         
00132         Chrome = <font class="keyword">new</font> wxMozillaBrowserChrome(<font class="keyword">this</font>);
00133         <font class="keywordflow">if</font>(!Chrome)
00134         {
00135                 printf(<font class="stringliteral">"Failed to create chrome!\n"</font>);
00136                 <font class="keywordflow">return</font> NS_ERROR_FAILURE;
00137         }
00138         NS_ADDREF(Chrome);
00139 
00140         Chrome-&gt;<a class="code" href="classwxMozillaBrowserChrome.html#a2">CreateBrowser</a>(-1, -1, -1, -1, getter_AddRefs(mWebBrowser));
00141 
00142         mBaseWindow = do_QueryInterface(mWebBrowser);
00143         mBaseWindow-&gt;SetPositionAndSize(0, 0, 300, 300, PR_TRUE);
00144         mBaseWindow-&gt;SetVisibility(PR_TRUE);
00145 
00146         mWebNav = do_QueryInterface(mWebBrowser);
00147         
00148         <font class="keywordflow">return</font> TRUE;
00149 }
00150 
<a name="l00160"></a><a class="code" href="classwxMozillaBrowser.html#a16">00160</a> <font class="keywordtype">void</font> <a class="code" href="classwxMozillaBrowser.html#a16">wxMozillaBrowser::OnSize</a>(wxSizeEvent &amp;pEvent)<font class="keyword"></font>
00161 {
00162         wxSize size = pEvent.GetSize();
00163         gdk_window_resize(m_widget-&gt;window, size.x, size.y);
00164         mBaseWindow-&gt;SetPositionAndSize(0, 0, size.x, size.y, PR_TRUE);
00165         mBaseWindow-&gt;SetVisibility(PR_TRUE);
00166         pEvent.Skip();
00167 }
00168 
<a name="l00178"></a><a class="code" href="classwxMozillaBrowser.html#a4">00178</a> <font class="keywordtype">bool</font> <a class="code" href="classwxMozillaBrowser.html#a4">wxMozillaBrowser::LoadURL</a>(<font class="keyword">const</font> wxString &amp;location)<font class="keyword"></font>
00179 {       
00180         nsresult rv;
00181         
00182         mURI.AssignWithConversion(<font class="stringliteral">"www.gnome.org"</font>);
00183         rv = mWebNav-&gt;LoadURI(mURI.get(), nsIWebNavigation::LOAD_FLAGS_NONE);
00184         <font class="keywordflow">if</font>(NS_FAILED(rv))
00185                 <font class="keywordflow">return</font> rv;
00186 
00187         <font class="keywordflow">return</font> TRUE;
00188 }
00189 
<a name="l00196"></a><a class="code" href="classwxMozillaBrowser.html#a5">00196</a> wxString <a class="code" href="classwxMozillaBrowser.html#a5">wxMozillaBrowser::GetURL</a>()<font class="keyword"></font>
00197 {
00198 }
00199 
<a name="l00209"></a><a class="code" href="classwxMozillaBrowser.html#a6">00209</a> <font class="keywordtype">void</font> <a class="code" href="classwxMozillaBrowser.html#a6">wxMozillaBrowser::SetProfilePath</a>(<font class="keyword">const</font> wxString &amp;path)<font class="keyword"></font>
00210 {
00211 }
00212 
<a name="l00219"></a><a class="code" href="classwxMozillaBrowser.html#a7">00219</a> <font class="keywordtype">bool</font> <a class="code" href="classwxMozillaBrowser.html#a7">wxMozillaBrowser::GoBack</a>()<font class="keyword"></font>
00220 {
00221 
00222         <font class="keywordflow">return</font> TRUE;
00223 }
00224 
<a name="l00231"></a><a class="code" href="classwxMozillaBrowser.html#a8">00231</a> <font class="keywordtype">bool</font> <a class="code" href="classwxMozillaBrowser.html#a8">wxMozillaBrowser::CanGoBack</a>()<font class="keyword"></font>
00232 {
00233         <font class="keywordflow">return</font> TRUE;
00234 }
00235 
<a name="l00242"></a><a class="code" href="classwxMozillaBrowser.html#a9">00242</a> <font class="keywordtype">bool</font> <a class="code" href="classwxMozillaBrowser.html#a9">wxMozillaBrowser::GoForward</a>()<font class="keyword"></font>
00243 {
00244 
00245         <font class="keywordflow">return</font> TRUE;
00246 }
00247 
<a name="l00254"></a><a class="code" href="classwxMozillaBrowser.html#a10">00254</a> <font class="keywordtype">bool</font> <a class="code" href="classwxMozillaBrowser.html#a10">wxMozillaBrowser::CanGoForward</a>()<font class="keyword"></font>
00255 {
00256         <font class="keywordflow">return</font> TRUE;
00257 }
00258 
<a name="l00265"></a><a class="code" href="classwxMozillaBrowser.html#a11">00265</a> <font class="keywordtype">bool</font> <a class="code" href="classwxMozillaBrowser.html#a11">wxMozillaBrowser::Stop</a>()<font class="keyword"></font>
00266 {
00267 
00268         <font class="keywordflow">return</font> TRUE;
00269 }
00270 
<a name="l00277"></a><a class="code" href="classwxMozillaBrowser.html#a12">00277</a> <font class="keywordtype">bool</font> <a class="code" href="classwxMozillaBrowser.html#a12">wxMozillaBrowser::Reload</a>()<font class="keyword"></font>
00278 {
00279 <font class="comment">//      if(mContentNav)</font>
00280 <font class="comment">//              mContentNav-&gt;Reload(flags);</font>
00281                 
00282         <font class="keywordflow">return</font> TRUE;
00283 }
00284 
<a name="l00297"></a><a class="code" href="classwxMozillaBrowser.html#a13">00297</a> <font class="keywordtype">bool</font> <a class="code" href="classwxMozillaBrowser.html#a13">wxMozillaBrowser::OpenStream</a>(<font class="keyword">const</font> wxString &amp;location, <font class="keyword">const</font> wxString &amp;type)<font class="keyword"></font>
00298 {
00299 <font class="comment">//      Stream-&gt;Open(location, type);</font>
00300 
00301         <font class="keywordflow">return</font> TRUE;
00302 }
00303 
00304 <font class="keywordtype">bool</font> wxMozillaBrowser::CloseStream()<font class="keyword"></font>
00305 {
00306 <font class="comment">//      Stream-&gt;Close();</font>
00307 }
00308 
<a name="l00318"></a><a class="code" href="classwxMozillaBrowser.html#a14">00318</a> <font class="keywordtype">bool</font> <a class="code" href="classwxMozillaBrowser.html#a14">wxMozillaBrowser::AppendToStream</a>(<font class="keyword">const</font> wxString &amp;data)<font class="keyword"></font>
00319 {
00320 <font class="comment">//      Stream-&gt;Append(data, data.length);</font>
00321         <font class="keywordflow">return</font> TRUE;
00322 }
00323 
<a name="l00330"></a><a class="code" href="classwxMozillaBrowser.html#a17">00330</a> wxString <a class="code" href="classwxMozillaBrowser.html#a17">wxMozillaBrowser::GetLinkMessage</a>()<font class="keyword"></font>
00331 {
00332 }
00333 
<a name="l00340"></a><a class="code" href="classwxMozillaBrowser.html#a18">00340</a> wxString <a class="code" href="classwxMozillaBrowser.html#a18">wxMozillaBrowser::GetJSStatus</a>()<font class="keyword"></font>
00341 {
00342 }
00343 
</pre></div><hr><address><small>Generated on Sat Oct 20 03:19:06 2001 by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.11 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
